<div *ngIf="user as user" class="profile">
  <button [matMenuTriggerFor]="menu" class="profile-button" mat-button>
    <img [ngSrc]="user.picture ?? ''" alt="avatar" class="avatar" height="32" priority width="32" />
  </button>

  <mat-menu #menu="matMenu" class="custom-profile-menu">
    <div class="menu-container">
      <div class="user-block">
        <img
          [ngSrc]="user.picture ?? ''"
          alt="avatar"
          class="avatar-large"
          height="64"
          priority
          width="64"
        />
        <div class="info">
          <div class="name">{{ user.name }}</div>
          <div class="username">&#64;{{ user.username }}</div>
        </div>
      </div>

      <mat-divider></mat-divider>

      <div class="email-section">
        <div (click)="$event.stopPropagation()" class="email">
          <label class="email-label" for="emailInput">Email-адрес</label>
          <input
            (ngModelChange)="onEmailChange($event)"
            [(ngModel)]="email"
            class="email-input"
            id="emailInput"
            placeholder="Email"
            type="email"
          />
        </div>

        <mat-checkbox
          (click)="$event.stopPropagation()"
          (ngModelChange)="onEmailNotificationsChange($event)"
          [(ngModel)]="enableEmailNotifications"
          class="email-checkbox"
        >
          Присылать уведомления
        </mat-checkbox>
      </div>

      <mat-divider></mat-divider>

      <button (click)="logout()" mat-menu-item>
        <mat-icon>logout</mat-icon>
        <span>Выйти</span>
      </button>
    </div>
  </mat-menu>
</div>
