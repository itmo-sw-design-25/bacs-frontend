<div class="reservations-page">
  <div class="page-head">
    <h1 class="page-title">Мои резервации</h1>
    <span class="count-badge" *ngIf="totalCount as n">{{ n }}</span>
  </div>

  <mat-tab-group
    [selectedIndex]="currentTab === 'upcoming' ? 0 : 1"
    (selectedIndexChange)="switchTab($event === 0 ? 'upcoming' : 'past')"
  >
    <mat-tab label="Предстоящие"></mat-tab>
    <mat-tab label="Прошедшие"></mat-tab>
  </mat-tab-group>

  <div class="filters-bar">
    <mat-form-field appearance="fill">
      <mat-label>Показывать по</mat-label>
      <mat-select [formControl]="limitControl" (valueChange)="changeLimit($event)">
        <mat-option *ngFor="let opt of limitOptions" [value]="opt">
          {{ opt }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Статус</mat-label>
      <mat-select [formControl]="statusControl" (valueChange)="changeStatuses($event)" multiple>
        <mat-option *ngFor="let opt of reservationStatuses" [value]="opt">
          {{ opt | reservationStatus }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Локация</mat-label>
      <mat-select [formControl]="locationsControl" (valueChange)="changeLocations($event)" multiple>
        <mat-option *ngFor="let opt of locations" [value]="opt">
          {{ opt.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Ресурс</mat-label>
      <mat-select [formControl]="resourcesControl" (valueChange)="changeResources($event)" multiple>
        <mat-option *ngFor="let opt of resources" [value]="opt">
          {{ opt.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div class="reservations-list">
    <bacs-reservation-card
      *ngFor="let reservationFull of displayedReservations"
      [reservation]="reservationFull.reservation"
      [location]="reservationFull.location"
      [resource]="reservationFull.resource"
      (created)="onReservationCreated($event)"
      (updated)="onReservationUpdated($event)"
      (cancelled)="onReservationCancelled($event)"
    ></bacs-reservation-card>
  </div>

  <div class="pagination-footer" *ngIf="hasMore">
    <button
      mat-flat-button
      color="primary"
      class="load-button"
      (click)="loadMore()"
      [disabled]="isLoading"
    >
      {{ isLoading ? 'Загрузка...' : 'Показать ещё' }}
    </button>
  </div>
</div>
